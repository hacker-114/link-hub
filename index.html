<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hacker114</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
  <header>
    <h1>Gaming Link Hub</h1>
    <h3>This collection was created by S-PScripts and Hacker114</h3>
    <h4>Some links may be blocked as the link hub was made for a separate school district!</h4>
  </header>

  <section id="search-section">
    <input type="text" id="search-input" placeholder="Search" />
  </section>

  <section id="file-tree-section">
    <div id="file-tree">Loading Resources...</div>
  </section>

  <script>
    const user = "S-PScripts";
    const repo = "chromebook-utilities";
    const branch = "main";
    const apiBase = `https://api.github.com/repos/${user}/${repo}/contents/`;

    // Toggle: true = use GitHub Pages URLs, false = use raw.githubusercontent URLs
    const usePages = true;

    function makeURL(path) {
      return usePages
        ? `${window.location.origin}/${repo}/${path}`
        : `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${path}`;
    }

    async function fetchTree(path = "") {
      const url = apiBase + path;
      const response = await fetch(url);
      if (!response.ok) {
        const li = document.createElement("li");
        li.textContent = `Error loading ${path}`;
        return li;
      }
      const items = await response.json();
      if (!Array.isArray(items)) return "";

      const ul = document.createElement("ul");
      for (const item of items) {
        const li = document.createElement("li");
        li.classList.add("tree-item");
        li.setAttribute("data-name", item.name.toLowerCase());

        if (item.type === "dir") {
          li.innerHTML = `<strong>üìÅ ${item.name}</strong>`;
          const subTree = await fetchTree(item.path);
          li.appendChild(subTree);
        } else if (item.type === "file") {
          const rawURL = makeURL(item.path);
          li.innerHTML = `<a href="${rawURL}" target="_blank">üìÑ ${item.name}</a>`;
        }
        ul.appendChild(li);
      }
      return ul;
    }

    fetchTree().then(tree => {
      const container = document.getElementById("file-tree");
      container.innerHTML = "";
      container.appendChild(tree);
    });

    document.getElementById("search-input").addEventListener("input", function () {
      const query = this.value.toLowerCase();
      document.querySelectorAll(".tree-item").forEach(item => {
        const name = item.getAttribute("data-name");
        item.style.display = name.includes(query) ? "" : "none";
      });
    });
  </script>
</body>
</html>
