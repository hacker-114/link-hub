<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chromebook Utilities Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- External Styles -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />

  <!-- jQuery (optional) -->
  <script src="https://code.jquery.com/jquery-3.7.1.js"
          integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
          crossorigin="anonymous"></script>
</head>
<body>
  <!-- Starfield Background -->
  <div id="starfield"></div>

  <!-- Title Section -->
  <h1 id="title">ğŸ“ Chromebook Utilities</h1>
  <h3>This collection was created by S-PScripts! Check out the source 
    <a href="https://github.com/S-PScripts/chromebook-utilities" target="_blank">here</a>
  </h3>
  <h4>If nothing loads, use the link above or download the 
    <a href="chromebook-utilities-sept2025.zip">repo</a>
  </h4>

  <!-- Search Section -->
  <div id="searchdiv">
    <input type="text" name="search" id="search" placeholder="Search files">
    <span class="material-symbols-outlined">search</span>
  </div>

  <!-- Error / status banner -->
  <div id="status" style="display:none;"></div>

  <!-- File Tree Section -->
  <div id="file-tree">Loading...</div>

  <!-- Feedback Button -->
  <div id="feedback-button">
    <a href="/form/index.html" target="_blank">Feedback</a>
  </div>

  <!-- Back Button -->
  <button id="back" onclick="window.open('/ppfn-static/','_self')">
    <span class="material-symbols-outlined">arrow_back</span>
  </button>

  <!-- Starfield Script -->
  <script>
    const starCount = 500;
    const starfield = document.getElementById('starfield');
    function random(min, max) { return Math.random() * (max - min) + min; }
    for (let i = 0; i < starCount; i++) {
      const star = document.createElement('div');
      star.classList.add('star');
      const size = random(0.5, 3);
      star.style.width = `${size}px`;
      star.style.height = `${size}px`;
      star.style.top = `${random(0, window.innerHeight)}px`;
      star.style.left = `${random(0, window.innerWidth)}px`;
      star.style.opacity = Math.random() * 0.8 + 0.2;
      star.style.animationDuration = `${random(3, 8)}s`;
      starfield.appendChild(star);
    }
  </script>

  <!-- GitHub File Tree Script with robust handling and link modes -->
  <script>
    const user   = "S-PScripts";
    const repo   = "chromebook-utilities";
    const branch = "main";
    const apiBase = `https://api.github.com/repos/${user}/${repo}/contents/`;

    // Choose how links should resolve:
    // 'origin'  -> links to files hosted on your current site (same origin)
    // 'raw'     -> links to raw GitHub content (downloads / raw text)
    // 'blob'    -> links to GitHub UI blobs (view on github.com)
    const linkMode = 'origin';

    function buildLink(path) {
      if (linkMode === 'origin') {
        // Serve from your current site (assumes you mirrored files here)
        // e.g., https://yoursite/Alternatives/Fandom Alternative Links.txt
        return `${window.location.origin}/${path}`;
      }
      if (linkMode === 'raw') {
        // Raw file content from GitHub (best for direct downloads)
        return `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${path}`;
      }
      // GitHub blob viewer (nice UI, not raw)
      return `https://github.com/${user}/${repo}/blob/${branch}/${path}`;
    }

    function showStatus(message) {
      const status = document.getElementById('status');
      status.style.display = 'block';
      status.textContent = message;
      // optional: you can style #status in your style.css for glow, etc.
    }

    async function fetchTree(path = "") {
      const url = apiBase + (path ? encodeURIComponent(path).replace(/%2F/g, '/') : "");
      try {
        const response = await fetch(url);
        // Handle rate limits, private repo, or missing path
        if (!response.ok) {
          showStatus(`Could not load GitHub contents (status ${response.status}). Showing local fallback.`);
          return buildFallbackTree();
        }

        const items = await response.json();
        const ul = document.createElement("ul");
        const list = Array.isArray(items) ? items : [items];

        for (const item of list) {
          const li = document.createElement("li");

          if (item.type === "dir") {
            li.innerHTML = `<strong>ğŸ“ ${item.name}</strong>`;
            const subTree = await fetchTree(item.path);
            li.appendChild(subTree);
          } else if (item.type === "file") {
            const href = buildLink(item.path);
            li.innerHTML = `<a href="${href}" target="_blank">ğŸ“„ ${item.name}</a>`;
          }

          ul.appendChild(li);
        }

        // If an empty directory, still show something
        if (!ul.childNodes.length) {
          const empty = document.createElement('li');
          empty.textContent = "(empty)";
          ul.appendChild(empty);
        }

        return ul;
      } catch (err) {
        showStatus("Network error loading GitHub contents. Showing local fallback.");
        return buildFallbackTree();
      }
    }

    // Local fallback tree (edit paths to match your deployment)
    function buildFallbackTree() {
      const ul = document.createElement("ul");

      const file1 = document.createElement("li");
      file1.innerHTML = `<a href="${buildLink('404.html')}" target="_blank">ğŸ“„ 404.html</a>`;
      ul.appendChild(file1);

      const altFolder = document.createElement("li");
      altFolder.innerHTML = `<strong>ğŸ“ Alternatives</strong>`;
      const altList = document.createElement("ul");

      const alt1 = document.createElement("li");
      alt1.innerHTML = `<a href="${buildLink('Alternatives/Fandom Alternative Links.txt')}" target="_blank">ğŸ“„ Fandom Alternative Links.txt</a>`;
      const alt2 = document.createElement("li");
      alt2.innerHTML = `<a href="${buildLink('Alternatives/Github Alternative Links.txt')}" target="_blank">ğŸ“„ Github Alternative Links.txt</a>`;
      const alt3 = document.createElement("li");
      alt3.innerHTML = `<a href="${buildLink('Alternatives/Google Workspace Alt Links.txt')}" target="_blank">ğŸ“„ Google Workspace Alt Links.txt</a>`;

      altList.appendChild(alt1);
      altList.appendChild(alt2);
      altList.appendChild(alt3);
      altFolder.appendChild(altList);
      ul.appendChild(altFolder);

      return ul;
    }

    // Render
    fetchTree().then(tree => {
      const container = document.getElementById("file-tree");
      container.innerHTML = "";
      container.appendChild(tree);
    });
  </script>
</body>
</html>
